# Grant Search SSF
# Structured Semantic Function for searching grants

name: "grant_search"
description: "Search for grant opportunities matching criteria"
version: "1.0"

# Input schema
inputs:
  - name: "keywords"
    type: "string"
    required: true
    description: "Search keywords for grant topics"
  - name: "organization_type"
    type: "string"
    required: false
    default: "nonprofit"
    enum: ["nonprofit", "government", "educational", "tribal", "any"]
  - name: "funding_range"
    type: "object"
    required: false
    properties:
      min: { type: "number", default: 0 }
      max: { type: "number", default: 1000000 }
  - name: "deadline_within_days"
    type: "number"
    required: false
    default: 90

# Output schema
outputs:
  - name: "grants"
    type: "array"
    items:
      type: "object"
      properties:
        name: { type: "string" }
        funder: { type: "string" }
        amount: { type: "string" }
        deadline: { type: "string" }
        eligibility: { type: "string" }
        url: { type: "string" }
  - name: "total_found"
    type: "number"
  - name: "search_summary"
    type: "string"

# Tools used by this SSF
tools:
  - web_search
  - database_query

# Execution steps
steps:
  - id: "search_web"
    action: "tool:web_search"
    params:
      query: "{{keywords}} grant funding {{organization_type}}"
    output: "web_results"

  - id: "search_database"
    action: "tool:database_query"
    params:
      collection: "grants"
      filter:
        keywords: "{{keywords}}"
        org_type: "{{organization_type}}"
    output: "db_results"

  - id: "merge_results"
    action: "transform"
    params:
      operation: "merge_dedupe"
      sources: ["{{web_results}}", "{{db_results}}"]
    output: "all_grants"

  - id: "filter_by_deadline"
    action: "filter"
    params:
      source: "{{all_grants}}"
      condition: "deadline <= now + {{deadline_within_days}} days"
    output: "filtered_grants"

  - id: "summarize"
    action: "llm"
    params:
      prompt: "Summarize these {{filtered_grants.length}} grant opportunities"
    output: "search_summary"

# Composable with other SSFs
composable: true
can_be_called_by:
  - "opportunity_analysis"
  - "grant_application_prep"
